<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simulador ‚Äî Automa√ß√£o & Solu√ß√µes Inteligentes na Log√≠stica</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
:root{
  --bg1:#0a1930; --bg2:#0d274e; --card:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.22); --ui:#fff; --accent:#11c46b; --blue:#1e8ffb;
}
html,body{background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff}
.container-narrow{max-width:1100px}
.card-glass{background:var(--card); border:1px solid var(--border); border-radius:16px; backdrop-filter:blur(8px)}
h1,h2,h3,h4{letter-spacing:.2px}
.badge-soft{background:rgba(255,255,255,.16); border:1px solid var(--border); border-radius:999px}
.progress .progress-bar{background:linear-gradient(90deg,#16a34a,#11c46b)}
/* ====== views com fade ====== */
#stage{position:relative; min-height:520px}
.view{position:absolute; inset:0; opacity:0; transform:translateY(8px) scale(.99); transition:opacity .35s ease, transform .35s ease; pointer-events:none}
.view.active{opacity:1; transform:none; pointer-events:auto}
.view.hidden{display:none}
/* ====== sticky controls ====== */
.controls{
  position: sticky; bottom: 10px; z-index: 20;
  background: rgba(0,0,0,.35); backdrop-filter: blur(6px);
  border:1px solid var(--border); border-radius:14px; padding:.6rem .75rem;
}
.btn-brand{background:#0b59c9; color:#fff; border:0; font-weight:800}
.btn-brand:hover{background:#094aa6}
.kbd{background:#111827;border:1px solid #374151;border-bottom-width:3px;border-radius:6px;padding:.05rem .35rem;font-weight:800}
hr{border-color:rgba(255,255,255,.2)}
/* drag & drop */
.drop{min-height:3rem;border:2px dashed rgba(255,255,255,.6);border-radius:.8rem;padding:.5rem;display:flex;flex-wrap:wrap;gap:.5rem}
.drag{padding:.35rem .55rem;background:#fff;color:#0b1324;border-radius:.6rem;font-weight:800;cursor:grab;user-select:none}
.small-muted{opacity:.9}
/* mobile tweaks */
@media (max-width: 576px){
  #stage{min-height:560px}
}
</style>
</head>
<body>
<nav class="navbar navbar-dark" style="background:linear-gradient(90deg,#0e9f58,#0b59c9)">
  <div class="container container-narrow">
    <span class="navbar-brand fw-bold">ü§ñüöö Simulador ‚Ä¢ Automa√ß√£o & Log√≠stica Inteligente</span>
    <span class="badge badge-soft text-white">ESG ‚Ä¢ Supply Chain ‚Ä¢ Ind√∫stria de Bebidas</span>
  </div>
</nav>

<header class="py-3">
  <div class="container container-narrow">
    <div class="row g-3 align-items-center">
      <div class="col-lg-8">
        <h1 class="h3 mb-1">Trilha Interativa ‚Äî da mat√©ria-prima ao consumidor</h1>
        <div class="d-flex align-items-center gap-3 flex-wrap">
          <div class="flex-grow-1">
            <div class="small-muted">Impacto ESG</div>
            <div class="progress" style="height:12px"><div class="progress-bar" id="barESG" style="width:0%"></div></div>
          </div>
          <div class="text-end">
            <div class="fs-4 fw-black" id="valESG">0%</div>
            <small class="small-muted">Progresso: <span id="valProgress">0</span>/8</small>
          </div>
        </div>
      </div>
      <div class="col-lg-4 text-lg-end">
        <button class="btn btn-brand" id="btnStart">‚ñ∂ Iniciar / Continuar</button>
        <div class="small mt-1"><a href="#" id="btnReset" class="link-light">Reiniciar</a></div>
      </div>
    </div>
  </div>
</header>

<main class="pb-5">
  <div class="container container-narrow">
    <div id="stage" class="position-relative"></div>

    <div class="controls d-flex justify-content-between align-items-center mt-3">
      <button class="btn btn-light text-dark fw-bold" id="btnPrev">‚óÄ Voltar</button>
      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-success fw-bold" id="btnCheck">Validar</button>
        <button class="btn btn-brand" id="btnNext">Avan√ßar ‚ñ∂</button>
      </div>
    </div>
  </div>
</main>

<footer class="py-4 text-center text-white-50">
  <div class="container container-narrow">
    <small>FEITEC ZL 2025 ‚Ä¢ Ind√∫stria de Bebidas ‚Ä¢ Cadeia Log√≠stica Inteligente ‚Ä¢ ESG üå±</small>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ================== estado & helpers ================== */
const store={get:(k,d)=>JSON.parse(localStorage.getItem(k)??JSON.stringify(d)),set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
let state=store.get('simlog_state',{idx:0,esg:0,done:Array(8).fill(false)});
function setESG(delta){state.esg=Math.max(0,Math.min(100,state.esg+(delta||0)));
  document.getElementById('barESG').style.width=state.esg+'%';
  document.getElementById('valESG').textContent=Math.round(state.esg)+'%';
  store.set('simlog_state',state);
}
function setDone(i){if(!state.done[i]){state.done[i]=true;store.set('simlog_state',state)};document.getElementById('valProgress').textContent=state.done.filter(Boolean).length;}
function toast(msg,type='success'){const w=document.createElement('div');w.className=`alert alert-${type} position-fixed top-0 start-50 translate-middle-x mt-3`;w.style.zIndex=9999;w.textContent=msg;document.body.appendChild(w);setTimeout(()=>w.remove(),1800);}

/* ================== navega√ß√£o c/ fade ================== */
const stage=document.getElementById('stage');
function fadeTo(newView){
  const current=stage.querySelector('.view.active');
  if(current){
    current.classList.remove('active');
    setTimeout(()=>{ current.remove(); stage.appendChild(newView); requestAnimationFrame(()=>newView.classList.add('active')); }, 200);
  }else{
    stage.appendChild(newView); requestAnimationFrame(()=>newView.classList.add('active'));
  }
}
function mkView(){const v=document.createElement('section');v.className='view card-glass p-3 active';return v;}
function goTo(i){
  if(i<0)i=0; if(i>Activities.length-1)i=Activities.length-1;
  state.idx=i; store.set('simlog_state',state);
  const v=mkView();
  const a=Activities[i];
  v.innerHTML = `
    <div class="d-flex align-items-center justify-content-between flex-wrap">
      <h2 class="h5 mb-2 mb-sm-0">${a.emoji} ${a.title}</h2>
      <span class="badge badge-soft">Etapa ${i+1}/8</span>
    </div>
    <div class="small text-white-50 mb-2">${a.caption}</div>
    <div id="content"></div>
  `;
  a.builder(v.querySelector('#content'),i);
  fadeTo(v);
}
document.getElementById('btnNext').onclick=()=>goTo(state.idx+1);
document.getElementById('btnPrev').onclick=()=>goTo(state.idx-1);
document.getElementById('btnStart').onclick=()=>goTo(state.idx||0);
document.getElementById('btnReset').onclick=(e)=>{e.preventDefault();if(confirm('Reiniciar simulador?')){localStorage.removeItem('simlog_state');location.reload();}};
document.getElementById('btnCheck').onclick=()=>{(Activities[state.idx].check||(()=>true))() && toast('‚úÖ Atividade registrada')};

/* ================== componentes menores ================== */
function numberInput(id,label,value,min=0,step=1){
  return `
  <div class="col-6 col-md-3">
    <label class="form-label">${label}</label>
    <input id="${id}" type="number" class="form-control form-control-sm" value="${value}" min="${min}" step="${step}">
  </div>`;
}
function badgeList(items){
  return `<div class="d-flex flex-wrap gap-2 mt-2">${items.map(t=>`<span class="badge badge-soft">${t}</span>`).join('')}</div>`;
}

/* ================== 8 atividades ================== */
const Activities=[];

/* 0) Intro */
Activities.push({
  emoji:'üó∫Ô∏è', title:'Mapa da Cadeia ‚Ä¢ Vis√£o Geral', caption:'Do fornecedor ao consumidor, veja onde a automa√ß√£o e IA aceleram o fluxo e reduzem emiss√µes.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-7">
          <div class="card-glass p-3 h-100">
            <p>Voc√™ est√° prestes a simular a cadeia log√≠stica de uma <b>ind√∫stria de bebidas</b> üç∫ü•§. Em cada etapa, interaja com mini-simuladores que mostram como <b>automa√ß√£o</b>, <b>IA</b>, <b>IoT</b>, <b>WMS/TMS</b>, <b>AGVs</b> e <b>RFID</b> geram efici√™ncia e impacto ESG.</p>
            <ul class="text-white-75">
              <li><b>Controles:</b> use os bot√µes <span class="kbd">‚óÄ</span> e <span class="kbd">‚ñ∂</span> para navegar; <b>Validar</b> registra sua a√ß√£o.</li>
              <li><b>Meta:</b> elevar o <b>Impacto ESG</b> ao longo da jornada üå±.</li>
            </ul>
            ${badgeList(['IoT','Roteiriza√ß√£o IA','AGV/Rob√¥s','RFID','Previs√£o de Demanda','Log√≠stica Reversa'])}
            <hr>
            <button class="btn btn-brand" onclick="goTo(${i+1})">Come√ßar ‚ñ∂</button>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3">
            <h6 class="mb-2">üö¶ Etapas</h6>
            <ol class="small">
              <li>Fornecimento (IoT + Reposi√ß√£o)</li>
              <li>Produ√ß√£o (OEE & Rob√¥s)</li>
              <li>Armaz√©m (WMS, Slotting & AGV)</li>
              <li>Picking Inteligente</li>
              <li>Transporte (TMS & Emiss√µes)</li>
              <li>Embalagem & Paletiza√ß√£o</li>
              <li>Varejo Conectado & Previs√£o</li>
              <li>Consumidor & Log√≠stica Reversa</li>
            </ol>
          </div>
        </div>
      </div>`;
    setDone(i);
  }, check:()=>true
});

/* 1) Fornecimento ‚Äî ponto de reposi√ß√£o (IoT) */
Activities.push({
  emoji:'üå±', title:'Fornecimento de Insumos (IoT + Reposi√ß√£o)', caption:'Sensores IoT + compras autom√°ticas: evite ruptura calculando o ponto de reposi√ß√£o (ROP).',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3 align-items-stretch">
        <div class="col-lg-7">
          <div class="card-glass p-3 h-100">
            <h6>üßÆ ROP ‚Äî Ponto de Reposi√ß√£o</h6>
            <div class="row g-2">
              ${numberInput('dDaily','Demanda di√°ria (un/dia)', 120, 1)}
              ${numberInput('lead','Lead time (dias)', 7, 1)}
              ${numberInput('ss','Estoque de seguran√ßa (un)', 300, 0)}
              ${numberInput('alpha','Varia√ß√£o (% sazonalidade)', 10, 0, 1)}
            </div>
            <button class="btn btn-success btn-sm mt-2" id="calc">Calcular</button>
            <div class="mt-2 small">
              <div class="p-2 rounded-3" style="background:rgba(255,255,255,.08); border:1px solid var(--border)" id="out">Preencha e calcule‚Ä¶</div>
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>Leitura IoT de n√≠veis de silos/caixas.</li>
              <li>Pedidos <b>aut√¥nomos</b> ao atingir ROP (API com fornecedores).</li>
              <li>Contrato din√¢mico: prioriza fornecedor com menor lead time/risco.</li>
            </ul>
            ${badgeList(['IoT','APIs','Gest√£o de Fornecedores','Anomalia em tempo real'])}
          </div>
        </div>
      </div>`;
    root.querySelector('#calc').onclick=()=>{
      const d=+document.getElementById('dDaily').value||0;
      const lt=+document.getElementById('lead').value||0;
      const ss=+document.getElementById('ss').value||0;
      const varp=(+document.getElementById('alpha').value||0)/100;
      const demandLT=d*lt*(1+varp);
      const rop=Math.round(demandLT+ss);
      document.getElementById('out').innerHTML=`ROP ‚âà <b>${rop}</b> un ‚Ä¢ Demanda no lead time ‚âà <b>${Math.round(demandLT)}</b> un<br><small class="text-white-50">Acione compra autom√°tica quando o estoque atingir ${rop}.</small>`;
      setESG(3); setDone(i);
    };
  }, check:()=>true
});

/* 2) Produ√ß√£o ‚Äî OEE simplificado */
Activities.push({
  emoji:'‚öôÔ∏è', title:'Produ√ß√£o Automatizada (Rob√¥s & OEE)', caption:'Me√ßa OEE e decida a√ß√µes autom√°ticas de melhoria.',
  builder:(root,i)=>{
    root.innerHTML=`
    <div class="row g-3">
      <div class="col-lg-6">
        <div class="card-glass p-3 h-100">
          <h6>üìà OEE ‚Äî Disponibilidade, Performance, Qualidade</h6>
          <div class="row g-2">
            ${numberInput('plan','Tempo planejado (min)', 480, 1)}
            ${numberInput('stop','Paradas (min)', 40, 0)}
            ${numberInput('ideal','Ciclo ideal (seg/un)', 1.2, .1, .1)}
            ${numberInput('good','Unidades boas', 21000, 0)}
            ${numberInput('total','Unidades totais', 22000, 0)}
          </div>
          <button class="btn btn-success btn-sm mt-2" id="oeeGo">Calcular</button>
          <div class="mt-2 small" id="oeeOut"></div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card-glass p-3 h-100">
          <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
          <ul class="small">
            <li>Rob√¥s de envase com autoajuste de velocidade.</li>
            <li>Vis√£o computacional para inspe√ß√£o de qualidade.</li>
            <li>Gatilhos: <b>se OEE&lt;85%</b> ‚Üí acionar manuten√ß√£o preditiva.</li>
          </ul>
          ${badgeList(['Rob√≥tica','Vis√£o','Preditiva','Andon Digital'])}
        </div>
      </div>
    </div>`;
    root.querySelector('#oeeGo').onclick=()=>{
      const plan=+document.getElementById('plan').value, stop=+document.getElementById('stop').value;
      const ideal=+document.getElementById('ideal').value, good=+document.getElementById('good').value, total=+document.getElementById('total').value;
      const run=Math.max(0,plan-stop);
      const A= run/plan;
      const rate = (total/run)/60; // un/min
      const idealRate = 60/ideal;
      const P= Math.min(1, rate/idealRate);
      const Q= (total? good/total : 0);
      const OEE = A*P*Q;
      document.getElementById('oeeOut').innerHTML=`
        Disponibilidade: <b>${(A*100).toFixed(1)}%</b> ‚Ä¢ Performance: <b>${(P*100).toFixed(1)}%</b> ‚Ä¢ Qualidade: <b>${(Q*100).toFixed(1)}%</b><br>
        <b>OEE:</b> <span class="badge bg-${OEE>=0.85?'success':OEE>=0.7?'warning':'danger'}">${(OEE*100).toFixed(1)}%</span>
        <div class="mt-1 text-white-50">A√ß√µes: ${OEE<0.85?'üìâ Ajustar par√¢metros + Preditiva':'üöÄ Manter e registrar aprendizado'}</div>`;
      setESG(3); setDone(i);
    };
  }, check:()=>true
});

/* 3) Armaz√©m ‚Äî Slotting (drag&drop) */
Activities.push({
  emoji:'üì¶', title:'WMS & Slotting (AGV/Rob√¥s)', caption:'Posicione itens nas zonas corretas (Frio/Sombra/Seco) para reduzir deslocamentos.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-md-7">
          <div class="card-glass p-3">
            <h6>üß© Arraste os itens para a zona ideal</h6>
            <div class="d-flex flex-wrap gap-2 mb-2" id="bank"></div>
            <div class="row g-2">
              <div class="col-12 col-md-4"><div class="p-2 card-glass"><b>‚ùÑÔ∏è Frio</b><div class="drop mt-2" id="zFrio"></div></div></div>
              <div class="col-12 col-md-4"><div class="p-2 card-glass"><b>üå§Ô∏è Sombra</b><div class="drop mt-2" id="zSombra"></div></div></div>
              <div class="col-12 col-md-4"><div class="p-2 card-glass"><b>üî• Seco</b><div class="drop mt-2" id="zSeco"></div></div></div>
            </div>
            <button class="btn btn-success btn-sm mt-2" id="slotCheck">Validar Slotting</button>
            <div class="small mt-2" id="slotOut"></div>
          </div>
        </div>
        <div class="col-md-5">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>WMS sugere slotting por giro/temperatura.</li>
              <li><b>AGVs</b> fazem reposi√ß√£o e picking.</li>
              <li>Invent√°rio com drones + RFID.</li>
            </ul>
            ${badgeList(['WMS','AGV','RFID','Drones'])}
          </div>
        </div>
      </div>`;
    const items=[
      {id:'L√∫pulo', tag:'Frio'},{id:'Xarope', tag:'Sombra'},{id:'Levedura', tag:'Frio'},
      {id:'R√≥tulos', tag:'Seco'},{id:'Latas', tag:'Seco'},{id:'Garrafas Vidro', tag:'Sombra'}
    ];
    const bank=root.querySelector('#bank');
    items.forEach(it=>{const d=document.createElement('div');d.className='drag';d.draggable=true;d.dataset.id=it.id;d.textContent=`${it.id}`;d.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',it.id));bank.appendChild(d);});
    const drops=['zFrio','zSombra','zSeco'].map(id=>root.querySelector('#'+id));
    drops.concat([bank]).forEach(el=>{el.addEventListener('dragover',e=>e.preventDefault()); el.addEventListener('drop',e=>{e.preventDefault();const id=e.dataTransfer.getData('text/plain'); el.appendChild(bank.querySelector(`[data-id="${id}"]`)||document.querySelector(`[data-id="${id}"]`));});});
    root.querySelector('#slotCheck').onclick=()=>{
      const get=(el)=>[...el.querySelectorAll('.drag')].map(d=>d.dataset.id);
      const pos={Frio:get(drops[0]), Sombra:get(drops[1]), Seco:get(drops[2])};
      const correct=items.filter(it=>pos[it.tag].includes(it.id)).length;
      root.querySelector('#slotOut').innerHTML=`Acertos: <b>${correct}/${items.length}</b> ‚Ä¢ ${correct>=5?'üéâ √ìtimo slotting (menos deslocamentos)':'üîß Ajuste posi√ß√µes'}`;
      setESG(correct>=5?4:2); setDone(i);
    };
  }, check:()=>true
});

/* 4) Picking Inteligente ‚Äî estrat√©gia */
Activities.push({
  emoji:'ü§ù', title:'Picking Inteligente (Batch & Zonas)', caption:'Escolha a estrat√©gia e compare tempo/energia.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card-glass p-3 h-100">
            <h6>üéØ Estrat√©gia</h6>
            <select id="pickMode" class="form-select form-select-sm">
              <option value="single">Single order (1 pedido por vez)</option>
              <option value="batch">Batch 2 pedidos</option>
              <option value="zonas">Zonas + AGV</option>
            </select>
            <div class="row g-2 mt-2">
              ${numberInput('itens','Itens por onda', 40, 1)}
              ${numberInput('dist','Dist√¢ncia m√©dia por item (m)', 12, 0.1, .1)}
              ${numberInput('vel','Velocidade do operador (m/s)', 1.3, .1, .1)}
            </div>
            <button class="btn btn-success btn-sm mt-2" id="pickGo">Simular</button>
            <div class="small mt-2" id="pickOut"></div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>Roteiro de picking com A* (mapa do armaz√©m).</li>
              <li>Batch picking + put-to-light.</li>
              <li>AGV leva caixas at√© doca.</li>
            </ul>
            ${badgeList(['A*','Put-to-light','AGV'])}
          </div>
        </div>
      </div>`;
    const eff={single:1, batch:0.78, zonas:0.58}; // menor = mais eficiente (menos metros)
    root.querySelector('#pickGo').onclick=()=>{
      const mode=document.getElementById('pickMode').value;
      const n=+document.getElementById('itens').value, d=+document.getElementById('dist').value, v=+document.getElementById('vel').value;
      const distTotal = n*d*eff[mode];
      const tempo = distTotal / v;
      const energia = distTotal * 0.05; // proxy (Wh)
      root.querySelector('#pickOut').innerHTML=`Dist√¢ncia total ‚âà <b>${distTotal.toFixed(1)} m</b> ‚Ä¢ Tempo ‚âà <b>${(tempo/60).toFixed(1)} min</b> ‚Ä¢ Energia ‚âà <b>${energia.toFixed(1)} Wh</b><br><small class="text-white-50">${mode==='zonas'?'üíö Melhor efici√™ncia e ergonomia.':'üí° Considere batch/zonas para reduzir caminhadas.'}</small>`;
      setESG(mode==='zonas'?4:mode==='batch'?3:1); setDone(i);
    };
  }, check:()=>true
});

/* 5) Transporte ‚Äî TMS & Emiss√µes */
Activities.push({
  emoji:'üöö', title:'Transporte (TMS & Emiss√µes)', caption:'Compare modais/combust√≠veis e consolida√ß√£o para reduzir CO‚ÇÇe e custo.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-7">
          <div class="card-glass p-3 h-100">
            <h6>üõ£Ô∏è Simulador de rota</h6>
            <div class="row g-2">
              ${numberInput('km','Dist√¢ncia total (km)', 180, 1)}
              ${numberInput('ton','Carga (t)', 10, 0.1, .1)}
              <div class="col-12 col-md-4">
                <label class="form-label">Modal</label>
                <select id="modal" class="form-select form-select-sm">
                  <option value="rod">Rodovi√°rio Diesel</option>
                  <option value="elec">Rodovi√°rio El√©trico</option>
                  <option value="ferro">Ferrovia</option>
                </select>
              </div>
              ${numberInput('cons','Custo por km (R$)', 5.2, 0.1, .1)}
            </div>
            <button class="btn btn-success btn-sm mt-2" id="tmsGo">Calcular</button>
            <div class="small mt-2" id="tmsOut"></div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>Otimiza√ß√£o de rotas e janelas de entrega.</li>
              <li>Telemetria / eco-driving com IA.</li>
              <li>Consolida√ß√£o multi-stop.</li>
            </ul>
            ${badgeList(['TMS','Telemetria','Eco-driving'])}
          </div>
        </div>
      </div>`;
    const EF={rod:0.12, elec:0.02, ferro:0.035}; // kg CO2e por t.km
    root.querySelector('#tmsGo').onclick=()=>{
      const km=+document.getElementById('km').value, t=+document.getElementById('ton').value;
      const modal=document.getElementById('modal').value, cpk=+document.getElementById('cons').value;
      const tkm=km*t, co2=tkm*EF[modal], cost=km*cpk;
      const co2Base=tkm*EF.rod, saved=Math.max(0,co2Base-co2);
      root.querySelector('#tmsOut').innerHTML=`tkm=<b>${tkm.toFixed(1)}</b> ‚Ä¢ CO‚ÇÇe=<b>${co2.toFixed(1)} kg</b> ‚Ä¢ Custo ‚âà <b>R$ ${cost.toFixed(2)}</b><br>vs Diesel: <b>‚àí${saved.toFixed(1)} kg</b> CO‚ÇÇe`;
      setESG(saved>0?4:1); setDone(i);
    };
  }, check:()=>true
});

/* 6) Embalagem & Paletiza√ß√£o */
Activities.push({
  emoji:'üßä', title:'Embalagem & Paletiza√ß√£o', caption:'Calcule quantas caixas cabem por palete respeitando altura m√°xima.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-7">
          <div class="card-glass p-3 h-100">
            <h6>üì¶ Paletiza√ß√£o</h6>
            <div class="row g-2">
              ${numberInput('pW','Palete L (cm)', 100, 10)}
              ${numberInput('pL','Palete C (cm)', 120, 10)}
              ${numberInput('maxH','Altura m√°x (cm)', 150, 10)}
              ${numberInput('cW','Caixa L (cm)', 20, 1)}
              ${numberInput('cL','Caixa C (cm)', 30, 1)}
              ${numberInput('cH','Caixa A (cm)', 25, 1)}
            </div>
            <button class="btn btn-success btn-sm mt-2" id="palGo">Calcular</button>
            <div class="small mt-2" id="palOut"></div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>Algoritmos de empacotamento 2D/3D.</li>
              <li>Rob√¥s paletizadores.</li>
              <li>Check de estabilidade & amarra√ß√£o.</li>
            </ul>
            ${badgeList(['Bin Packing','Rob√≥tica','Seguran√ßa'])}
          </div>
        </div>
      </div>`;
    root.querySelector('#palGo').onclick=()=>{
      const pW=+pal('pW'), pL=+pal('pL'), maxH=+pal('maxH'), cW=+pal('cW'), cL=+pal('cL'), cH=+pal('cH');
      function pal(id){return document.getElementById(id).value}
      const perLayer=Math.max(0, Math.floor(pW/cW)*Math.floor(pL/cL));
      const layers=Math.max(0, Math.floor(maxH/cH));
      const total=perLayer*layers;
      document.getElementById('palOut').innerHTML=`Por camada: <b>${perLayer}</b> ‚Ä¢ Camadas: <b>${layers}</b> ‚Ä¢ Total/palete: <b>${total}</b>`;
      setESG(2); setDone(i);
    };
  }, check:()=>true
});

/* 7) Varejo Conectado ‚Äî previs√£o simples (EWMA) */
Activities.push({
  emoji:'üè¨', title:'Varejo Conectado & Previs√£o', caption:'Aplique suaviza√ß√£o exponencial para prever a pr√≥xima semana.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-7">
          <div class="card-glass p-3 h-100">
            <h6>üìà Suaviza√ß√£o exponencial (EWMA)</h6>
            <div class="row g-2">
              <div class="col-12">
                <label class="form-label">S√©rie de vendas (v√≠rgula)</label>
                <input id="serie" class="form-control form-control-sm" value="120,132,145,150,166,172">
              </div>
              <div class="col-6 col-md-3">
                <label class="form-label">Œ± (0‚Äì1)</label>
                <input id="alpha2" type="number" class="form-control form-control-sm" value="0.3" step="0.05" min="0" max="1">
              </div>
            </div>
            <button class="btn btn-success btn-sm mt-2" id="prevGo">Prever</button>
            <div class="small mt-2" id="prevOut"></div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3 h-100">
            <h6>ü§ñ Automa√ß√£o nesta etapa</h6>
            <ul class="small">
              <li>Reposi√ß√£o autom√°tica por RFID no PDV.</li>
              <li>Promo√ß√µes din√¢micas com IA.</li>
              <li>Orquestra√ß√£o omnichannel.</li>
            </ul>
            ${badgeList(['RFID','Demand Sensing','Omnichannel'])}
          </div>
        </div>
      </div>`;
    root.querySelector('#prevGo').onclick=()=>{
      const s=document.getElementById('serie').value.split(',').map(x=>+x.trim()).filter(x=>!isNaN(x));
      const a=Math.min(1,Math.max(0, +document.getElementById('alpha2').value||0.3));
      if(s.length<2){toast('S√©rie curta','warning');return}
      let F=s[0]; for(let t=1;t<s.length;t++){F = a*s[t-1] + (1-a)*F;}
      const next = a*s[s.length-1] + (1-a)*F;
      document.getElementById('prevOut').innerHTML=`Previs√£o pr√≥xima = <b>${next.toFixed(1)}</b> ‚Ä¢ √öltimo n√≠vel suavizado = <b>${F.toFixed(1)}</b>`;
      setESG(2); setDone(i);
    };
  }, check:()=>true
});

/* 8) Consumidor & Log√≠stica Reversa ‚Äî quiz */
Activities.push({
  emoji:'üë§', title:'Consumidor & Log√≠stica Reversa', caption:'Finalize com um quiz r√°pido e veja seu impacto ESG acumulado.',
  builder:(root,i)=>{
    root.innerHTML=`
      <div class="row g-3">
        <div class="col-lg-7">
          <div class="card-glass p-3">
            <h6>üìù Quiz (3 perguntas)</h6>
            <ol class="small">
              <li>üîÅ RFID no varejo ajuda a‚Ä¶<br>
                <label><input type="radio" name="q1"> deixar o estoque est√°tico</label><br>
                <label><input type="radio" name="q1" value="ok"> atualizar estoque em tempo real</label>
              </li>
              <li>üöö Emiss√µes por transporte reduzem quando‚Ä¶<br>
                <label><input type="radio" name="q2" value="ok"> consolido entregas e uso modal limpo</label><br>
                <label><input type="radio" name="q2"> fa√ßo mais viagens vazias</label>
              </li>
              <li>‚ôªÔ∏è Log√≠stica reversa eficiente‚Ä¶<br>
                <label><input type="radio" name="q3" value="ok"> reaproveita embalagens e reduz CO‚ÇÇe</label><br>
                <label><input type="radio" name="q3"> s√≥ aumenta custo</label>
              </li>
            </ol>
            <button class="btn btn-success btn-sm" id="quizGo">Conferir</button>
            <div class="small mt-2" id="quizOut"></div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card-glass p-3 h-100">
            <h6>üéâ Resultado da Trilha</h6>
            <div class="small">Seu ESG acumulado: <b id="esgFinal">‚Äî</b></div>
            <div class="mt-2"><button class="btn btn-brand btn-sm" onclick="goTo(0)">üîÑ Recome√ßar</button></div>
          </div>
        </div>
      </div>`;
    root.querySelector('#quizGo').onclick=()=>{
      const ok=['q1','q2','q3'].every(q=> root.querySelector(`input[name=${q}][value=ok]:checked`));
      root.querySelector('#quizOut').innerHTML = ok ? '‚úÖ 3/3 ‚Äî Excelente! Log√≠stica reversa e dados conectados fazem a diferen√ßa.' : '‚ö†Ô∏è Revise e tente novamente.';
      if(ok){ setESG(5); setDone(i); }
      document.getElementById('esgFinal').textContent=Math.round(state.esg)+'%';
    };
  }, check:()=>true
});

/* ================== inicializa√ß√£o ================== */
setESG(0); document.getElementById('valProgress').textContent=state.done.filter(Boolean).length;
goTo(state.idx||0);
</script>
</body>
</html>
